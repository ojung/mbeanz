#!/bin/bash

DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)

MBEANZ="java -jar ${DIR}/../target/uberjar/mbeanz-0.1.0-SNAPSHOT-standalone.jar"

MBEAN_AND_OPERATION=$(${MBEANZ} -m list | fzf)

MBEAN=$(echo $MBEAN_AND_OPERATION | awk '{print $1}')
OPERATION=$(echo $MBEAN_AND_OPERATION | awk '{print $2}')

DESCRIBE_PARAMS=$(${MBEANZ} -m params -b $MBEAN -o ${OPERATION:1})

${MBEANZ} -m describe -b $MBEAN -o ${OPERATION:1}

if [ -z "$DESCRIBE_PARAMS" ]; then
  ${MBEANZ} -m invoke -b $MBEAN -o ${OPERATION:1}
else
  echo "Arguments:"
  echo "$DESCRIBE_PARAMS"
  read -p "enter args separated by space: " user_input
  ${MBEANZ} -m invoke -b $MBEAN -o ${OPERATION:1} <<< "$user_input"
fi
